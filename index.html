<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Piano Scale Master - Pro Version</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .white-key { width: 48px; height: 200px; transition: transform 0.05s, background-color 0.05s; }
        .black-key { width: 32px; height: 120px; margin-left: -16px; transition: transform 0.05s; }
        .key-pressed { transform: translateY(4px) !important; }
        .piano-container { min-width: 360px; } 
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        const PianoScaleGame = () => {
          const [gameState, setGameState] = useState('playing');
          const [score, setScore] = useState(0);
          const [lives, setLives] = useState(3);
          const [currentStep, setCurrentStep] = useState(0);
          const [showLabels, setShowLabels] = useState(true);
          const audioContextRef = useRef(null);

          useEffect(() => {
            audioContextRef.current = new (window.AudioContext || window.webkitAudioContext)();
          }, []);

          const notes = [
            { note: 'C', freq: 261.63, isBlack: false, oct: 1 }, { note: 'C#', freq: 277.18, isBlack: true, oct: 1 },
            { note: 'D', freq: 293.66, isBlack: false, oct: 1 }, { note: 'D#', freq: 311.13, isBlack: true, oct: 1 },
            { note: 'E', freq: 329.63, isBlack: false, oct: 1 }, { note: 'F', freq: 349.23, isBlack: false, oct: 1 },
            { note: 'F#', freq: 369.99, isBlack: true, oct: 1 }, { note: 'G', freq: 392.00, isBlack: false, oct: 1 },
            { note: 'G#', freq: 415.30, isBlack: true, oct: 1 }, { note: 'A', freq: 440.00, isBlack: false, oct: 1 },
            { note: 'A#', freq: 466.16, isBlack: true, oct: 1 }, { note: 'B', freq: 493.88, isBlack: false, oct: 1 }
          ];

          const currentScale = { name: 'Master Scale Challenge', sequence: ['C', 'D', 'E', 'F', 'G', 'A', 'B'] };

          const playNote = (f) => {
            const ctx = audioContextRef.current;
            const osc = ctx.createOscillator();
            const g = ctx.createGain();
            osc.connect(g); g.connect(ctx.destination);
            osc.frequency.value = f;
            g.gain.setValueAtTime(0.2, ctx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.4);
            osc.start(); osc.stop(ctx.currentTime + 0.4);
          };

          const handlePress = (n) => {
            playNote(n.freq);
            if (n.note === currentScale.sequence[currentStep]) {
              if (currentStep === currentScale.sequence.length - 1) {
                setCurrentStep(0);
                setScore(s => s + 50);
              } else {
                setCurrentStep(s => s + 1);
                setScore(s => s + 10);
              }
            } else {
              setLives(l => Math.max(0, l - 1));
            }
          };

          const whiteNotes = notes.filter(n => !n.isBlack);
          const blackNotes = notes.filter(n => n.isBlack);

          return (
            <div className="min-h-screen bg-slate-50 p-8 flex flex-col items-center font-sans">
              
              {/* Score & Lives Header */}
              <div className="w-full max-w-4xl flex justify-between items-center mb-6 bg-white p-4 rounded-2xl shadow-sm border border-slate-200">
                <div className="flex items-center gap-4">
                  <div className="text-sm font-bold text-slate-400 uppercase tracking-tight">Score</div>
                  <div className="text-2xl font-black text-indigo-600">{score}</div>
                </div>
                
                {/* DIFFICULTY TOGGLE */}
                <div className="flex items-center gap-3">
                  <span className="text-xs font-bold text-slate-500 uppercase">Labels</span>
                  <button 
                    onClick={() => setShowLabels(!showLabels)}
                    className={`w-12 h-6 rounded-full transition-colors duration-200 relative ${showLabels ? 'bg-indigo-500' : 'bg-slate-300'}`}
                  >
                    <div className={`absolute top-1 w-4 h-4 bg-white rounded-full transition-all duration-200 ${showLabels ? 'left-7' : 'left-1'}`} />
                  </button>
                </div>

                <div className="flex gap-1 text-xl">
                  {Array.from({length: 3}).map((_, i) => (
                    <span key={i} className={i < lives ? "grayscale-0" : "grayscale opacity-30"}>❤️</span>
                  ))}
                </div>
              </div>

              {/* Progress Tracker */}
              <div className="mb-10 text-center">
                <h2 className="text-sm font-black text-slate-400 uppercase tracking-[0.2em] mb-4">{currentScale.name}</h2>
                <div className="flex flex-wrap justify-center gap-2">
                  {currentScale.sequence.map((n, i) => (
                    <div key={i} className={`w-10 h-10 flex items-center justify-center rounded-xl font-bold transition-all ${i === currentStep ? 'bg-yellow-400 scale-110 shadow-md ring-2 ring-yellow-200' : i < currentStep ? 'bg-green-100 text-green-600' : 'bg-white text-slate-300'}`}>
                      {n}
                    </div>
                  ))}
                </div>
              </div>

              {/* The Piano */}
              <div className="relative inline-block bg-slate-800 p-8 pt-16 rounded-[40px] shadow-[0_30px_60px_-12px_rgba(0,0,0,0.4)] border-t-[14px] border-slate-700 piano-container">
                <div className="flex relative bg-slate-400 p-[1px] rounded-sm overflow-hidden">
                  
                  {/* White Keys */}
                  {whiteNotes.map((n, i) => (
                    <div
                      key={i}
                      onClick={() => handlePress(n)}
                      className="white-key bg-white border-r border-slate-200 hover:bg-slate-50 active:key-pressed cursor-pointer flex items-end justify-center pb-6 rounded-b-xl shadow-[inset_0_-8px_0_#f0f0f0,0_4px_0_#ccc]"
                    >
                      {showLabels && <span className="text-[10px] font-black text-slate-400 uppercase">{n.note}{n.oct}</span>}
                    </div>
                  ))}

                  {/* Black Keys Layer */}
                  <div className="absolute top-0 left-0 w-full h-0 pointer-events-none">
                    {whiteNotes.map((_, i) => {
                      const pattern = [0, 1, 3, 4, 5]; 
                      
                      if (pattern.includes(i % 7)) {
                        const oct = Math.floor(i / 7) + 1;
                        const noteName = ['C#','D#','F#','G#','A#'][pattern.indexOf(i % 7)];

                        const blackNoteObj = blackNotes.find(bn => bn.note === noteName && bn.oct === oct);
                        if (!blackNoteObj) return null;

                        return (
                          <div
                            key={i}
                            onClick={(e) => { e.stopPropagation(); handlePress(blackNoteObj); }}
                            style={{ left: `${(i + 1) * 48}px` }}
                            className="black-key absolute top-0 pointer-events-auto bg-gradient-to-b from-slate-700 via-slate-900 to-black hover:from-slate-600 active:key-pressed rounded-b-lg shadow-[0_6px_10px_rgba(0,0,0,0.5),inset_0_-4px_0_#333] border-x border-slate-950 flex items-end justify-center pb-4"
                          >
                            {showLabels && <span className="text-[9px] font-bold text-slate-500">{blackNoteObj.note}</span>}
                          </div>
                        );
                      }
                      return null;
                    })}
                  </div>
                </div>
              </div>

              <div className="mt-12 text-slate-400 text-xs font-medium uppercase tracking-widest">
                Tap the keys to complete the sequence
              </div>
            </div>
          );
        };

        ReactDOM.render(<PianoScaleGame />, document.getElementById('root'));
    </script>
</body>
</html>
